name: ubuntu-faster-whisper

services:
  faster-whisper:
    image: radu103/ubuntu-faster-whisper:latest
    volumes:
      # Mount a local directory for audio files (change the left side to your local path)
      - ./audio:/app/audio
      # Mount a local directory for output transcriptions
      - ./output:/app/output
      # Mount models downloaded by the container ofr persistence
      - ./cache:/root/.cache
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Bucharest
      - WHISPER_MODEL=large-v3-turbo
      - WHISPER_BEAM=10               #optional, default is 5
      - WHISPER_LANG=ro               #optional
      # PostgreSQL settings (optional - comment out if not using PostgreSQL)
      - POSTGRES_HOST=postgres      #uncomment to use PostgreSQL
      - POSTGRES_PORT=5432          #uncomment to use PostgreSQL
      - POSTGRES_DB=whisper         #uncomment to use PostgreSQL
      - POSTGRES_USER=postgres       #uncomment to use PostgreSQL
      - POSTGRES_PASSWORD=postgres #uncomment to use PostgreSQL
    ports:
      - "10301:10301"
    # Enable GPU support
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu, compute, utility]    # Keep the container running
    stdin_open: true
    tty: true
    # Link to postgres service if using PostgreSQL
    depends_on:
      - postgres

  # PostgreSQL database service (optional)
  postgres:
    image: postgres:15-alpine
    environment:
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_USER=postgres
      - POSTGRES_DB=postgres
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    restart: unless-stopped

  pgadmin4:
    depends_on:
      - postgres
    image: dpage/pgadmin4:9.3.0
    ports:
      - 54321:80
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@pgadmin4.com
      PGADMIN_DEFAULT_PASSWORD: admin
    volumes:
      - pgadmin4_data:/var/lib/pgadmin
    restart: unless-stopped

volumes:
  postgres_data:
    driver: local
  pgadmin4_data:
    driver: local